---
title: "Patent review"
output: html_document
---

```{r, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
library(knitr)
opts_chunk$set(echo=FALSE, message=FALSE)
```


```{r,echo=FALSE, message=FALSE, results='hide', warning=FALSE}
# Loading libraries
library(ggplot2)
library(splitstackshape)
library(igraph)

# Set ggplot theme
theme_set(theme_minimal(15))
```


```{r, echo=FALSE, warning=FALSE, results='hide', message=FALSE}
# Loading and preparing data

# Call cleaning2.R to process the data in the input folder and 
# save processed files to output folder
source("patent_cleaning.R", chdir = T)

# Helper function to remove leading and trailing whitespace
trim <- function (x) gsub("^\\s+|\\s+$", "", x)

# Fixing variable types

```
This report provides an analysis on the records downloaded from [Web of Science Derwent Innovation Index](http://webofscience.com) . The analysis identifies the important inventors and assignees in the dataset based on the number of occurences.

Reports can be generated by using the [online analysis service](http://hammer.nailsproject.net/), and the source code is available at [GitHub](https://github.com/aknutas/nails). Instructions and links to tutorial videos can be found at the [project page](https://aknutas.github.io/nails/). For further details see the following article: [Knutas, A., Hajikhani, A., Salminen, J., Ikonen, J., Porras, J., 2015. Cloud-Based Bibliometric Analysis Service for Systematic Mapping Studies. CompSysTech 2015](http://www.codecamp.fi/lib/exe/fetch.php/wiki/nails-compsystech2015-preprint.pdf). Please cite our research paper on bibliometrics if you publish the analysis results. Use is otherwise free. 

The analysed dataset consist of `r nrow(patents)` records with `r ncol(patents)` variables. More information about the variables can be found at [Web of Science](https://images.webofknowledge.com/WOKRS56B5/help/WOK/hs_dii_fieldtags_patents.html). 

## Publication years 
```{r, echo=FALSE, warning=FALSE, message=FALSE}
ggplot(patents, aes(Year)) +
  geom_histogram(binwidth = 1, fill = "darkgreen") +
  ggtitle("Year published") + 
  xlab("Year") + 
  ylab("Article count")


```

## Important inventors
```{r}
inventors <- as.data.frame(table(patentsByInventor$Inventors))
inventors <- inventors[with (inventors, order(-Freq)), ]
inventors <- transform(inventors, Var1 = reorder(Var1, Freq))

ggplot(head(inventors, 25), aes(Var1, Freq)) +
    geom_bar(stat = "identity", fill = "blue") + 
    coord_flip() +
    ggtitle("Productive inventors") + 
    xlab("Inventor") + 
    ylab("Number of patents")
```

## Important assignees
```{r}
assignees <- as.data.frame(table(patentsByAssignee$Companies))
assignees <- assignees[with (assignees, order(-Freq)), ]
assignees <- transform(assignees, Var1 = reorder(Var1, Freq))

ggplot(head(assignees, 25), aes(Var1, Freq)) +
    geom_bar(stat = "identity", fill = "blue") + 
    coord_flip() +
    ggtitle("Productive assignees") + 
    xlab("Assignee") + 
    ylab("Number of patents") 
```


## International Patent Classification
```{r}
classes <- as.data.frame(table(patentsByIPC$Class))
classes <- classes[with (classes, order(-Freq)), ]
classes <- transform(classes, Var1 = reorder(Var1, Freq))

ggplot(head(classes, 25), aes(Var1, Freq)) +
  geom_bar(stat = "identity", fill = "blue") + 
  coord_flip() +
  ggtitle("Common classes") + 
  xlab("Number of patents") + 
  ylab("Class") 
```

## Classes, patents and years
```{r}
top10Classes <- head(classes$Var1, 10)
patentsByIPC$Class <- as.character(patentsByIPC$Class)
top10Data <- patentsByIPC[patentsByIPC$Class %in% top10Classes, ]
classByYear <- as.data.frame(table(top10Data$Class, top10Data$Year))
names(classByYear) <- c("Class", "Year", "Freq")
classByYear$Class <- factor(classByYear$Class)
classByYear$Year <- as.integer(as.character(classByYear$Year))

ggplot(classByYear, aes(Year, Freq, color = Class)) + 
  geom_line(aes(group = Class)) + 
  ylab("Number of patents") +
  ggtitle("Patent trends")
```

## Number of inventors
```{r}
ggplot(patents, aes(InventorCount)) + 
  geom_histogram(binwidth = 1) +
  xlab("Number of inventors") +
  ylab("Count")+
  ggtitle("Number of inventors")

round(table(patents$InventorCount) / nrow(patents), 3)
```

## Number of assignees
```{r}
ggplot(patents, aes(AssigneeCount)) + 
  geom_histogram(binwidth = 1) +
  xlab("Number of assignees") +
  ylab("Count")+
  ggtitle("Number of assignees")

round(table(patents$AssigneeCount) / nrow(patents), 3)
```

## Technology profiles of top 10 companies
```{r}
top10Companies <- as.character(head(assignees$Var1, 10))

patentsByTop10 <- patentsByAssignee[patentsByAssignee$Companies %in% 
                                      top10Companies, ]
patentsByTop10$Companies <- as.character(patentsByTop10$Companies)
patentsByTop10 <- cSplit(patentsByTop10, 
                         splitCols = "InternationalPatentClassification", 
                         sep = ";", direction = "long")
patentsByTop10$InternationalPatentClassification <- as.character(
  patentsByTop10$InternationalPatentClassification)
patentsByTop10$Class <- substr(patentsByTop10$InternationalPatentClassification, 
                               1, 3)


top10Classes <- head(classes$Var1, 10)
patentsByTop10$Class <- as.character(patentsByTop10$Class)
top10Data <- patentsByTop10[patentsByTop10$Class %in% top10Classes, ]
patentsByTop10$Class <- as.character(patentsByTop10$Class)
classByCompany <- as.data.frame(table(top10Data$Class, top10Data$Companies))
names(classByCompany) <- c("Class", "Assignees", "Freq")
classByCompany$Class <- factor(classByCompany$Class)

ggplot(classByCompany, aes(Assignees, Freq, color = Class)) + 
  geom_line(aes(group = Class)) + 
  ylab("Number of patents") +
  ggtitle("Patents of top companies") +
  coord_flip()
```

